# **Spots（旧 Live Map）企画書・要件定義書**

## **1. コンセプト**
リアルな街の“今”を地図上で共有し、誰もがイベントを発信・発見できる  
「ライブマップ型イベント共有SNS」。  
地元密着から全国規模のフェスまで、瞬時に見つかる・つながる・動ける世界を実現する。
暇つぶしや週末の予定、会社終わりの軽い遊びまでこのサービスを見ればすべて解決する。
これまでの喫茶店で暇つぶしなどの行動が変容する、毎日新しい発見に満ちた生活をサポートする。

---

## **2. 開発方針**
- **地図 × SNS × イベント告知** の融合プラットフォーム。  
- 投稿の健全性と信頼性を重視しつつ、誰でも参加しやすい設計。  
- 軽快なUIとレスポンスを最優先。  
- インディーズや地域イベントにも光を当てる構造。  

---

## **3. アカウント機能**

### **3.1 ユーザー機能（ログイン後）**
| 機能 | 内容 | 優先度 |
|------|------|--------|
| スポット投稿 | イベント・場所・企画を投稿 | ★必須 |
| いいね | 投稿へのリアクション | ★必須 |
| 通報機能 | 不適切な投稿に対する通報 | ★必須 |
| 行きたい登録 | 行きたいマークを設定。イベント開始時に通知 | ☆後回し可 |
| フォロー機能 | 投稿者（イベンター）をフォローし、通知または強調表示 | ☆後回し可 |
| sNS連携 | sns連携できるようにする | ☆後回し可 |

---

## **4. 投稿の健全性維持システム**

### **4.1 審査・ペナルティ設計**
| 機能 | 概要 | 備考 |
|------|------|------|
| 投稿審査 | アカウント審査とイベント審査の2段階構成 | 信頼性確保 |
| アカウント審査 | SNS・WEBサイト連携・クレジットカード連携などを必須化 | 「第一の砦」 |
| イベント審査 | 内容・日付・場所の自動チェック＋通報制 | 「第二の砦」 |
| 虚偽投稿ペナルティ | 虚偽イベント投稿時にアカウント停止・通報対象化 | 必須 |
| ドタキャンペナルティ | 開始直前キャンセルには重いペナルティを科す | 必須 |
| 信頼スコア | フォロワー数・いいね数・通報履歴から算出 | メルカリ方式 |
| 通報制限 | 1日あたり通報回数制限。過剰通報は無視またはロック | 迷惑行為対策 |

【アカウント審査】
Spotsにおける「メール＋SMS認証併用設計」
「見る・フォロー・いいね」は自由、「投稿（＝社会的行動）」をするときだけ実名性を担保する
アカウント作成は軽く（メール・Google連携）、投稿は重く（SMSによる実在確認）という二層構造で、UXを壊さずに信頼性を上げる構成

1 新規登録
　└ メール認証 or Googleアカウント連携で登録完了
　　→ すぐにログイン・閲覧可能
2️ 閲覧・フォロー・いいねなど自由行動
3️ 「投稿」ボタンを押下
　└ 投稿内容入力 → 「投稿する」クリック時にSMS認証要求
4️ SMSコード入力画面
　└ 6桁コード入力 → 成功で認証済みフラグ付与
5️ 認証後は全投稿でSMS不要（1回きり）
6️ プロフィールに「✅認証済みバッジ」表示

投稿実行前に「phoneVerified」をチェックするのがポイント。
認証済みなら一瞬で通り、未認証ならSMS入力モーダルを出すUX。

UX設計のポイント（地雷を踏まない）
ポイント	具体策
途中離脱を防ぐ	投稿フォームの最後でSMSを挟む（最初に出すと離脱率↑）
文言トーンはやわらかく	「本人確認のためにSMSコードをお送りします📱」など温かい言い回し
認証済みの見える化	投稿カードやプロフィールに「✅認証済み」マークを表示
再認証タイミング	電話番号変更／通報累積など高リスク時のみ再要求
エラー対応	SMSが届かない場合の再送案内と制限（3回まで）

コスト最適化ポイント
項目	対策
送信件数削減	投稿時のみ送信（通常ログインでは不要）
無料枠利用	Firebase Authなら月10,000件まで無料
再送制限	同番号への再送を3回まで・1分間隔でブロック
再認証頻度最小化	1回のSMS認証でずっと有効。番号変更時のみ再認証。
電話番号入力ミスを抑え、再送コストを抑える仕組み

1) 国選択は自動推定＋明示：初期値 JP (+81)、変更可（海外ユーザー配慮）。
電話専用キーボード：inputmode="tel", autocomplete="tel"。
見た目と内部を分離：画面は人間可読のフォーマット、内部は E.164（例：+819012345678）。
2) 入力中にミスを起こしにくく
リアルタイム整形（libphonenumber）：090-1234-5678 のように自動で見やすく。
先頭ゼロの扱い：日本の携帯 0 から始まる→E.164では +81 に変換し先頭の 0 を一つだけ落とす。
長さ・接頭辞ガード：桁数不足/過多、あり得ない接頭辞（例：000）を即時エラー表示。
連続/同一数字の異常検知：0000000000, 1111111111 などは警告。
貼り付け時のクレンジング：スペース・記号全削除、全角→半角。
3) 送信前に“最後の一押し”
確認ダイアログ：「+81 90-****-1234 にSMSを送信します。よろしいですか？」（末尾2–4桁だけ可視化）。
戻る導線：その場で「番号を修正」リンクを必ず置く。
4) 認証フローでの気づき
コード画面で再表示：「+81 90-****-1234 に送信しました」＋「番号を変更」。
Androidなら Web OTP API 対応（自動読み取りで打ち間違い根絶）。
再送はレート制限：連打で“別番号入力のつもり”を隠さない（例：60秒クールダウン）。
5) バリデーションの深度
構文チェック：libphonenumber で国別最適化。
ライン種別チェック（任意）：Twilio Lookup 等で携帯回線か判定（固定電話を弾く）。
リスク低減：同一番号の短時間での認証試行や多数アカ作成を検知（IP/端末指紋）。
6) アクセシビリティと言葉
即時・具体的なメッセージ：「桁数が足りません（現在9桁／必要10–11桁）」。
色だけに依存しない（アイコン＋テキスト）。

セキュリティ設計（運用上の工夫）
項目	実装方針
データ保存	電話番号は非可逆ハッシュ化（直接保存しない）
認証結果	users.phoneVerified = true のみ保存
不正防止	同一番号の複数登録を禁止（Firebaseが自動管理）
スパム対策	同IPからの大量SMS送信を自動遮断（Firebase RateLimit）

【信頼スコア（トラストスコア）基盤】
各アカウントに trust_score（0〜100）を内部的に持たせる。
初期値は60〜70程度（普通レベル）。

スコアは以下の行動で増減：
行動 |	スコア変動 |	備考
虚偽イベント投稿 |　-50	 | 即警告＋投稿制限
ドタキャン（1時間前以降） |	-20	 | イベント開催直前
ドタキャン（24時間前） |	-5 | 	軽度
通報を多く受ける（正当と判定） | 	-10〜-30 | AIまたは運営が判定
通報乱発（虚偽通報）	 | -10	 | 他ユーザー攻撃防止
いいね・フォロワー増 | 	+1〜+5	 | 信頼上昇補正
過去イベント実施成功	 | +10 | 	主催経験を評価

trust_score < 40 → 投稿審査が強化される（手動審査に移行）
trust_score < 20 → アカウント一時停止
trust_score < 10 → 完全BAN（再登録不可）

【段階的な警告システム】
ステージ	条件	対応
🟡 警告	1件目の虚偽投稿／複数通報	DM＋注意喚起表示
🟠 投稿制限	信頼スコア40未満	投稿は審査制／新規投稿不可
🔴 停止	信頼スコア20未満	1週間～無期限停止（運営判断）

【通報システムの最適化】
通報上限：1日3件まで（アカウント信頼度に応じて変動可）
通報内容分類：

① 虚偽イベント
② スパム／広告
③ 不適切内容（暴力・アダルトなど）
④ その他（自由記述）

通報信頼度（report_score）を各ユーザーにも付与し、
「正当な通報が多い人」＝通報の重みを上げる。
（逆に虚偽通報が多い人はreport_scoreを下げて無視される）


【ドタキャンペナルティ】
24時間以上前：-5  
1〜24時間前：-15  
開始1時間以内：-25  
無断ドタキャン：-50
一方で「悪天候・災害・主催者都合など正当理由」は運営判定で免除。

【リカバリーポイント】
一定期間「良好行動」が続くと信頼スコアが徐々に回復。

【表示ロジックとの連携】
トップ表示アルゴリズムに trust_score を組み込み、
高スコア → 広告・トップ枠表示優先
低スコア → 下位表示・審査対象
これにより自然に「健全な投稿者が目立つ」エコシステムが成立。

---

## **5. トップ画面構成（イベント強調設計）**

### **5.1 表示構成比（例）**
| 区分 | 概要 | 割合 |
|------|------|------|
| 広告枠 | 有料プレミアム枠（常時掲載） | 約60% |
| 人気投稿者枠 | 高フォロワー・高信頼度アカウント | 約20% |
| 中間層枠 | 通常人気の投稿 | 約10% |
| インディーズ枠 | 新規・少フォロワーの投稿 | 約10% |

- 広告枠は金額に応じて表示優先度（プレミアム／通常）を設定。  
- 投稿数制限により「お金を払ったのに表示されない」事態を防止。  

【動的な割合制御（固定比ではなく条件連動）】
曜日・時間帯・地域のアクティビティに応じて動的に割合を調整する。

例：時間帯別動的配分
状況	広告	人気	中間	インディーズ
平日昼（利用少）	40%	30%	15%	15%
週末午後（アクティブ多）	50%	25%	15%	10%
夜間（探索重視）	30%	25%	20%	25%

→ こうすることで「常に広告ばかり」という印象を避け、
利用者が“自分で発見する喜び”を感じやすくなります。

【広告枠の信頼フィルタリング】
広告を金額だけで上位表示させるのではなく、一定の信頼スコア条件を課すことが重要。
（例：trust_score >= 60 のアカウントのみ広告掲載可）

広告タイプ	表示条件	備考
プレミアム広告	有料＋信頼スコア60以上	常時表示可
通常広告	有料＋スコア50以上	表示頻度制限あり
無審査広告	×（禁止）	品質維持のため非対応

【“公平な露出機会”を担保するロジック】
「人気者が常にトップ」になる構造は、中長期的に新規投稿者のモチベを削ぐ。
「リフレッシュ・アルゴリズム」を導入（score = (trust_score * 0.4) + (like_count * 0.3) + (recency_score * 0.3)）

---

## **6. イベント表示方法**

### **6.1 地図ビュー**
- **吹き出しUI：**
  - プレミアム投稿 → 常時表示＋内容の一部を可視化。  
  - 通常投稿 → 拡大時のみ吹き出し表示。  
- **中域表示時：**
  - プレミアム投稿 → 吹き出し表示
  - 通常投稿はパルスピン方式で簡略表示。  
  - 投稿密度が低い場合、吹き出しが3秒ごとに切り替わり、街が“生きている”ように見せる。
- **広域表示時：**
  - ホバーグリッド、バブルクラスタ方式で簡略表示。  
  - 視覚的な統計（例：件数や人気度の熱量）も表現。  
- **UI制約：**
  - 軽量動作を最優先。  
  - 世界地図レベルのズームは不要。日本地域中心に限定。  

### **6.2 リストビュー**
- スマートニュース／アソビューのようなカード式デザイン。  
- 表示内容：画像・タイトル・所要時間・費用。  
- 並び替え：距離順・開催日順など。  

### **6.3 共通機能**
- カテゴリ・タグによる絞り込み。  
- アドバンスドサーチ機能（条件検索）。
- 将来的にレコメンド機能も追加  

アイデア一覧
【表示の多様性を保つ演出（UX面）】
吹き出しUIを「人気」「新着」「広告」で微妙に色や動きを変える。
ユーザーが“自然にカテゴリの違いを理解”できるようにする。
例：
広告枠：金色グラデーション
人気投稿：青色系
インディーズ：緑／白など柔らかい色調

【吹き出しui】
・“イベント情報を載せる”ではなく“街そのものが話しかけてくるような体験”

たとえば——
屋台が「焼きそば始まったよ！」と吹き出す
路上ライブが「今ここで歌ってる！」と地図上で跳ねる
小さなギャラリーが「今日だけ展示中」とつぶやく

ユーザーがマップを眺めるだけで、
街が“生きている”“声をかけてくる”ように感じる。

・リズムアニメーション（Pulse & Pop）
吹き出しがリズミカルに“ポンッ”と浮かぶ（呼吸のように）
3秒ごとに異なるイベントが順に吹き出す
プレミアム枠は消えずに常時浮遊

・リアルタイム性強化
吹き出しが“時間”とリンクすることで臨場感が増す。
イベント状態	吹き出し内容例
開始30分前	「もうすぐ始まるよ！」
開始中	「今まさに開催中🔥」
終了後	「今日はありがとう！」
→ バックエンドで event_status を監視し、メッセージ更新。

技術的ヒント（軽量に動かすために）
吹き出しはすべてReact側で制御せず、MapboxのMarker要素＋CSSアニメーションで表現。
表示件数が多いときは「吹き出し出現率」を調整（例：表示範囲の10〜20%だけアクティブ）。
吹き出しDOMを再生成せず、CSSクラス切替で見た目だけ変更。

---

## **7. トレンド機能**
- 地図範囲外も含めた人気イベントのランキング。  
- 「近日公開」「話題急上昇」などの注目枠を設置。  
- 将来的にショート動画による告知機能も追加予定。  

---

## **8. 通知システム**
| トリガー | 通知内容 |
|-----------|-----------|
| フォロー中ユーザーの投稿 | プッシュ通知（ON設定時） |
| 自分の投稿にいいね | 1回目・10回目・50回目・100回目・500回目・1000回目で通知 |
| フォローされた時 | 通知あり |
| 行きたい登録イベントの開催前 | 通知（オプション） |

---

## **9. 起動時レスポンス**
- **スタート画面（ローディング画面）**を用意し、描画完了まで待機。  
- 初回ロード後はキャッシュ活用で高速表示。  

---

## **10. 広告出稿・収益モデルの詳細定義**
基本導線　→　地図上イベントを発見 → 興味を持つ → 詳細を見る → 行動に移す

・UI的には「イベント詳細 → 関連リンク → 予約・購入」で流れるように配置。  
・投稿者（イベンター）へのアフィリエイト開放（UGC収益化）
投稿フォームに「関連リンクを追加」ボタンを設ける
（Amazonアソシエイト・チケットサイト・自社LPなど）
クリック数・コンバージョンを自動トラッキング
運営が一定の手数料を取る形（例：売上の10〜20%）

・通知・フォロー経由のアフィリエイト導線
例「お気に入りの投稿者が新しいイベントを投稿しました」
　　↓
　通知内に「チケットをチェックする」リンク（外部アフィリエイト）

・グルメ系にはホットペッパーなどのメディア連携




## **11. 今後の検討項目**
- イベント信頼度スコアの具体的アルゴリズム設計。  
- 地図UIの軽量化方式（WebGL / Mapbox / Google Maps API比較）。  
- 通報AI（自動判定）導入の検討。  
- 投稿ダブり対策
- 犯罪、嘘対策 
---

## **12. UI/UXの方向性**
- “街が動く”ように見える動的UI。  
- 吹き出しの自然なアニメーション（3秒ごと切替）。  
- 重すぎない処理で直感的な操作感を維持。  

---

## **13. バージョン目標**
| バージョン | 実装範囲 |
|-------------|-----------|
| α版 | 投稿・いいね・地図表示（最小構成） |
| β版 | 通知・信頼スコア・通報機能追加 |
| 1.0 | 広告枠／トレンド機能／アドバンスドサーチ実装 |
